<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🎙️ Mic Recording Test</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>

<h1>🎙️ Mic Recording and Playback Test</h1>

<button id="startBtn">Start Recording</button>
<button id="playBtn" disabled>Play Recording</button>

<br><br>
<audio id="audioPlayer" controls></audio>

<script>
const startBtn = document.getElementById("startBtn");
const playBtn = document.getElementById("playBtn");
const audioPlayer = document.getElementById("audioPlayer");

let audioChunks = [];

startBtn.addEventListener("click", async () => {
  if (!navigator.mediaDevices || !window.MediaRecorder) {
    alert("Your browser doesn't support audio recording.");
    return;
  }

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const recorder = new MediaRecorder(stream);

  audioChunks = []; // reset previous

  recorder.ondataavailable = (event) => {
    audioChunks.push(event.data);
  };

  recorder.onstop = () => {
    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' }); // Type hint only
    console.log("🎤 Audio Blob size:", audioBlob.size, "bytes");

    const audioURL = URL.createObjectURL(audioBlob);
    audioPlayer.src = audioURL;
    playBtn.disabled = false;
  };

  recorder.start();
  console.log("🎤 Recording started...");

  startBtn.disabled = true;
  setTimeout(() => {
    recorder.stop();
    console.log("🛑 Recording stopped after 5 seconds");
    startBtn.disabled = false;
  }, 5000);
});

playBtn.addEventListener("click", () => {
  if (audioPlayer.src) {
    audioPlayer.play();
  }
});
</script>

</body>
</html>